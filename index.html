<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelpMarq - Expert insights. Accessible pricing.</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
      <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div>
                    <h1>HelpMarq</h1>
                    <p class="tagline">Expert insights. Accessible pricing.</p>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <div id="user-button-container"></div>
                    <button onclick="manualSignOut()" class="btn-danger btn-small">Sign Out</button>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <section class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="totalProjects">0</div>
                <div class="stat-label">Projects</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalReviewers">0</div>
                <div class="stat-label">Reviewers</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalApplications">0</div>
                <div class="stat-label">Applications</div>
            </div>
        </section>

        <!-- Tab Navigation -->
   <nav class="tab-nav">
    <button class="tab-btn active" data-tab="projects">Browse Projects</button>
    <button class="tab-btn" data-tab="upload" id="uploadTabBtn">Upload Project</button>
    <button class="tab-btn" data-tab="dashboard">My Dashboard</button>
    <button class="tab-btn" data-tab="apply" id="applyTabBtn">Apply as Reviewer</button>
    <button class="tab-btn" data-tab="reviewers">Top Reviewers</button>
</nav>

        <!-- Tab: Browse Projects -->
        <div id="projects-tab" class="tab-content active">
            <section class="section">
                <div class="section-header">
                    <h2>Available Projects</h2>
                    <div class="filters">
                        <input 
                            type="text" 
                            id="searchProjects" 
                            placeholder="Search projects..." 
                            class="search-input"
                        >
                        <select id="filterType" class="filter-select">
                            <option value="">All Types</option>
                            <option value="website">Website</option>
                            <option value="app">Mobile App</option>
                            <option value="design">Design</option>
                            <option value="pitch">Pitch Deck</option>
                            <option value="business">Business Idea</option>
                            <option value="other">Other</option>
                        </select>
                        <select id="filterMinXP" class="filter-select">
                            <option value="">All XP</option>
                            <option value="100">100+ XP</option>
                            <option value="200">200+ XP</option>
                            <option value="300">300+ XP</option>
                        </select>
                        <select id="sortProjects" class="filter-select">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="highestXP">Highest XP</option>
                            <option value="lowestXP">Lowest XP</option>
                            <option value="mostApplicants">Most Applicants</option>
                        </select>
                        <button id="refreshBtn" class="btn-secondary">‚Üª Refresh</button>
                    </div>
                </div>

                <div id="projectsGrid" class="projects-grid">
                    <div class="loading">Loading projects</div>
                </div>

                <div id="projectsPagination" class="pagination"></div>
            </section>
        </div>

        <!-- Tab: Upload Project -->
        <div id="upload-tab" class="tab-content">
            <section class="section">
                <h2>Upload New Project</h2>
                <p class="section-subtitle">Get verified, multi-perspective feedback delivered in 48 hours</p>
                
                <form id="uploadForm" class="upload-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="title">Project Title *</label>
                            <input 
                                type="text" 
                                id="title" 
                                placeholder="e.g., My SaaS Landing Page"
                                required
                            >
                            <small>Minimum 5 characters</small>
                        </div>

                        <div class="form-group">
                            <label for="type">Project Type *</label>
                            <select id="type" required>
                                <option value="">Select type...</option>
                                <option value="website">Website</option>
                                <option value="app">Mobile App</option>
                                <option value="design">Design/Portfolio</option>
                                <option value="pitch">Pitch Deck</option>
                                <option value="business">Business Idea</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea 
                            id="description" 
                            rows="4" 
                            placeholder="Describe what feedback you're looking for..."
                            required
                        ></textarea>
                        <small>Minimum 20 characters</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="link">Project Link *</label>
                            <input 
                                type="url" 
                                id="link" 
                                placeholder="https://example.com"
                                required
                            >
                        </div>

                        
                    <div class="form-row">
                        <div class="form-group">
                            <label for="xpReward">XP Reward *</label>
                            <input 
                                type="number" 
                                id="xpReward" 
                                min="50" 
                                max="500" 
                                placeholder="100"
                                required
                            >
                            <small>Between 50 and 500 XP</small>
                        </div>

                        <div class="form-group">
                            <label for="deadline">Review Deadline *</label>
                            <input 
                                type="datetime-local" 
                                id="deadline" 
                                required
                            >
                            <small>When feedback should be delivered</small>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary" id="submitBtn">
                        Upload Project
                    </button>
                </form>

                <div id="uploadMessage" class="message"></div>
            </section>
        </div>

        <!-- Tab: Apply as Reviewer -->
        <div id="apply-tab" class="tab-content">
            <section class="section">
                <h2>Apply as Reviewer</h2>
                <p class="section-subtitle">Build credibility while earning income. Complete structured reviews on your schedule.</p>
                
                <!-- Create Reviewer Profile First -->
                <div id="reviewerSetup" class="reviewer-setup">
                    <h3>Create Your Reviewer Profile</h3>
                    <form id="reviewerForm" class="form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="reviewerUsername">Username *</label>
                                <input 
                                    type="text" 
                                    id="reviewerUsername" 
                                    placeholder="e.g., DesignerMike"
                                    required
                                >
                            </div>

                            <div class="form-group">
                                <label for="reviewerEmail">Email *</label>
                                <input 
                                    type="email" 
                                    id="reviewerEmail" 
                                    placeholder="your@email.com"
                                    required
                                >
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="reviewerBio">Bio (Optional)</label>
                            <textarea 
                                id="reviewerBio" 
                                rows="3" 
                                placeholder="Tell us about your experience..."
                            ></textarea>
                        </div>

                        <button type="submit" class="btn-primary">Create Profile</button>
                    </form>
                </div>

                <!-- Application Form (shown after profile created) -->
                <div id="applicationSection" class="application-section" style="display: none;">
                    <h3>Select a Project to Review</h3>
                    <div id="applyProjectsList" class="apply-projects-list">
                        <div class="loading">Loading available projects...</div>
                    </div>
                </div>

                <div id="applyMessage" class="message"></div>
            </section>
        </div>

        <!-- Tab: Top Reviewers -->
        <div id="reviewers-tab" class="tab-content">
            <section class="section">
                <h2>Top Reviewers</h2>
                <p class="section-subtitle">Verified experts delivering multi-perspective feedback</p>
                <div id="reviewersList" class="reviewers-list">
                    <div class="loading">Loading reviewers...</div>
                </div>
            </section>
        </div>
<!-- Tab: My Dashboard (Owner/Reviewer) -->
        <div id="dashboard-tab" class="tab-content">
            <section class="section">
                <h2 id="dashboardTitle">My Dashboard</h2>
                
                <!-- Owner Dashboard -->
                <div id="ownerDashboard" style="display: none;">
                    <div class="dashboard-stats">
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-value" id="ownerTotalProjects">0</div>
                            <div class="stat-label">Your Projects</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üìã</div>
                            <div class="stat-value" id="ownerTotalApplicants">0</div>
                            <div class="stat-label">Total Applicants</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üí¨</div>
                            <div class="stat-value" id="ownerTotalFeedback">0</div>
                            <div class="stat-label">Total Reviews</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">‚ö†Ô∏è</div>
                            <div class="stat-value" id="ownerPendingActions">0</div>
                            <div class="stat-label">Pending Actions</div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Your Projects</h3>
                    <div id="ownerProjectsList" class="projects-grid">
                        <div class="loading">Loading your projects</div>
                    </div>
                </div>
                
                <!-- Reviewer Dashboard -->
                <div id="reviewerDashboard" style="display: none;">
                    <div class="dashboard-stats">
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üèÜ</div>
                            <div class="stat-value" id="reviewerLevel">1</div>
                            <div class="stat-label">Level</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="reviewerXP">0</div>
                            <div class="stat-label">Total XP</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üìù</div>
                            <div class="stat-value" id="reviewerTotalReviews">0</div>
                            <div class="stat-label">Reviews Completed</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="reviewerAvgRating">0.0</div>
                            <div class="stat-label">Avg Rating</div>
                        </div>
                    </div>
                    
                    <div style="margin: 2rem 0;">
                        <h3 style="margin-bottom: 1rem;">XP Progress to Next Level</h3>
                        <div class="xp-progress-bar">
                            <div id="xpProgressFill" class="xp-progress-fill"></div>
                        </div>
                        <p id="xpProgressText" style="text-align: center; margin-top: 0.5rem; color: var(--neutral-mid);"></p>
                    </div>
                    
                    <h3 style="margin-bottom: 1rem;">Your Applications</h3>
                    <div id="reviewerApplicationsList">
                        <div class="loading">Loading your applications</div>
                    </div>
                </div>
            </section>
        </div>
        <!-- Application Modal -->
        <div id="applicationModal" class="modal">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <h2>Apply to Review Project</h2>
                <div id="modalProjectInfo" class="modal-project-info"></div>
                
                <form id="applicationForm" class="form">
                    <div class="form-group">
                        <label for="qualifications">Why are you qualified? *</label>
                        <textarea 
                            id="qualifications" 
                            rows="4" 
                            placeholder="Explain your relevant experience and expertise..."
                            required
                        ></textarea>
                        <small>Minimum 20 characters</small>
                    </div>

                    <div class="form-group">
                        <label for="focusAreas">What will you focus on? *</label>
                        <textarea 
                            id="focusAreas" 
                            rows="4" 
                            placeholder="Describe what aspects you'll review..."
                            required
                        ></textarea>
                        <small>Minimum 20 characters</small>
                    </div>

                    <div class="nda-section">
                        <div class="nda-box">
                            <h4>Non-Disclosure Agreement (NDA)</h4>
                            <div class="nda-content">
                                <p><strong>By submitting this application, you agree to:</strong></p>
                                <ul>
                                    <li>Keep all project materials, ideas, and information strictly confidential</li>
                                    <li>Not share, copy, or distribute any project content without explicit permission</li>
                                    <li>Use project information solely for the purpose of providing feedback</li>
                                    <li>Delete all project materials after completing your review</li>
                                    <li>Not use any project ideas or concepts for your own commercial purposes</li>
                                </ul>
                                <p style="margin-top: 1rem;"><strong>Violation of this agreement may result in:</strong></p>
                                <ul>
                                    <li>Immediate account suspension</li>
                                    <li>Legal action for breach of confidentiality</li>
                                    <li>Loss of all earned XP and payments</li>
                                </ul>
                            </div>
                            <label class="nda-checkbox">
                                <input type="checkbox" id="ndaAccept" required>
                                <span>I have read and agree to the Non-Disclosure Agreement *</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary" id="submitApplicationBtn">Submit Application</button>
                </form>
            </div>
        </div>

        <!-- Applicants Modal (for project owners) -->
        <div id="applicantsModal" class="modal">
            <div class="modal-content modal-large">
                <span class="modal-close applicants-close">&times;</span>
                <h2>Project Applicants</h2>
                <div id="applicantsList" class="applicants-list">
                    <div class="loading">Loading applicants...</div>
                </div>
            </div>
        </div>
        <!-- Feedback Modal (for approved reviewers) -->
<div id="feedbackModal" class="modal">
    <div class="modal-content">
        <span class="modal-close feedback-close">&times;</span>
        <h2>Submit Feedback</h2>
        <div id="feedbackProjectInfo" class="modal-project-info"></div>
        
        <form id="feedbackForm" class="form">
            <div class="form-group">
                <label for="feedbackText">Your Feedback *</label>
                <textarea 
                    id="feedbackText" 
                    rows="8" 
                    placeholder="Provide detailed, constructive feedback..."
                    required
                ></textarea>
                <small>Minimum 50 characters</small>
            </div>

            <div class="form-group">
                <label for="projectRating">Rate This Project (Optional)</label>
                <select id="projectRating">
                    <option value="">No rating</option>
                    <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ Excellent</option>
                    <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ Good</option>
                    <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ Average</option>
                    <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ Below Average</option>
                    <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ Poor</option>
                </select>
            </div>

            <button type="submit" class="btn-primary" id="submitFeedbackBtn">Submit Feedback</button>
        </form>
    </div>
</div>

<!-- Feedback List Modal (for project owners) -->
<div id="feedbackListModal" class="modal">
    <div class="modal-content modal-large">
        <span class="modal-close feedback-list-close">&times;</span>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3);">
            <h2 style="margin: 0;">Project Feedback</h2>
            <button class="btn-secondary btn-small" onclick="downloadFeedback()" id="downloadFeedbackBtn">
                üì• Download All
            </button>
        </div>
        <div id="feedbackList" class="feedback-list">
            <div class="loading">Loading feedback</div>
        </div>
    </div>
</div>
    </div>

  <script 
        async 
        crossorigin="anonymous" 
        data-clerk-publishable-key="pk_test_Y29ycmVjdC1zdGlua2J1Zy05OS5jbGVyay5hY2NvdW50cy5kZXYk"
        onload="window.Clerk.load()"
        src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@4/dist/clerk.browser.js"
    ></script>

    <script>
        window.addEventListener('load', async () => {
            console.log('Index page loading...');
            
            if (!window.Clerk) {
                console.error('Clerk failed to load');
                return;
            }
            
            await window.Clerk.load();
            console.log('Clerk loaded');

            if (!window.Clerk.user) {
                console.log('No user, redirecting to login');
                window.location.href = 'login.html';
                return;
            }

            console.log('User found:', window.Clerk.user.id);
            window.clerk = window.Clerk;

            const userButtonContainer = document.getElementById('user-button-container');
            if (userButtonContainer) {
                window.Clerk.mountUserButton(userButtonContainer, {
                    afterSignOutUrl: 'login.html'
                });
                
                // Listen for sign out
                window.Clerk.addListener(({ user }) => {
                    if (!user) {
                        console.log('User signed out, clearing role');
                        localStorage.removeItem('userRole');
                        window.location.href = 'login.html';
                    }
                });
            }
            // Manual sign out function
            window.manualSignOut = async function() {
                console.log('Manual sign out triggered');
                try {
                    // Clear all local data
                    localStorage.clear();
                    sessionStorage.clear();
                    
                    // Sign out from Clerk
                    await window.Clerk.signOut();
                    
                    // Force redirect after short delay
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 500);
                } catch (error) {
                    console.error('Sign out error:', error);
                    // Force redirect anyway
                    localStorage.clear();
                    window.location.href = 'login.html';
                }
            };

            console.log('Loading app.js...');
            const script = document.createElement('script');
            script.src = 'app.js';
            script.onload = () => console.log('app.js loaded successfully');
            script.onerror = () => console.error('Failed to load app.js');
            document.body.appendChild(script);
        });
        
    </script>
</body>
</html>