<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelpMarq - Expert insights. Accessible pricing.</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div>
                    <h1>HelpMarq</h1>
                    <p class="tagline">Expert insights. Accessible pricing.</p>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span id="userName" style="font-weight: 600; color: var(--neutral-dark);"></span>
                    <button onclick="handleSignOut()" class="btn-danger btn-small">Sign Out</button>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <section class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="totalProjects">0</div>
                <div class="stat-label">Projects</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalReviewers">0</div>
                <div class="stat-label">Reviewers</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalApplications">0</div>
                <div class="stat-label">Applications</div>
            </div>
        </section>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="projects">Browse Projects</button>
            <button class="tab-btn" data-tab="upload" id="uploadTabBtn" style="display: none;">Upload Project</button>
            <button class="tab-btn" data-tab="apply" id="applyTabBtn" style="display: none;">Apply to Review</button>
            <button class="tab-btn" data-tab="dashboard">My Dashboard</button>
            <button class="tab-btn" data-tab="reviewers">Top Reviewers</button>
        </nav>

        <!-- Tab: Browse Projects -->
        <div id="projects-tab" class="tab-content active">
            <section class="section">
                <div class="section-header">
                    <h2>Available Projects</h2>
                    <div class="filters">
                        <input 
                            type="text" 
                            id="searchProjects" 
                            placeholder="Search projects..." 
                            class="search-input"
                        >
                        <select id="filterType" class="filter-select">
                            <option value="">All Types</option>
                            <option value="website">Website</option>
                            <option value="app">Mobile App</option>
                            <option value="design">Design</option>
                            <option value="pitch">Pitch Deck</option>
                            <option value="business">Business Idea</option>
                            <option value="other">Other</option>
                        </select>
                        <select id="sortProjects" class="filter-select">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="highestXP">Highest XP</option>
                            <option value="lowestXP">Lowest XP</option>
                        </select>
                        <button id="refreshBtn" class="btn-secondary">‚Üª Refresh</button>
                    </div>
                </div>

                <div id="projectsGrid" class="projects-grid">
                    <div class="loading">Loading projects</div>
                </div>

                <div id="projectsPagination" class="pagination"></div>
            </section>
        </div>

        <!-- Tab: Upload Project (Owner only) -->
        <div id="upload-tab" class="tab-content">
            <section class="section">
                <h2>Upload New Project</h2>
                <p class="section-subtitle">Get verified feedback delivered in 48 hours</p>
                
                <form id="uploadForm" class="upload-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="title">Project Title *</label>
                            <input 
                                type="text" 
                                id="title" 
                                placeholder="e.g., My SaaS Landing Page"
                                required
                                minlength="5"
                                maxlength="100"
                            >
                        </div>

                        <div class="form-group">
                            <label for="type">Project Type *</label>
                            <select id="type" required>
                                <option value="">Select type...</option>
                                <option value="website">Website</option>
                                <option value="app">Mobile App</option>
                                <option value="design">Design</option>
                                <option value="pitch">Pitch Deck</option>
                                <option value="business">Business Idea</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea 
                            id="description" 
                            rows="4" 
                            placeholder="Describe what feedback you're looking for..."
                            required
                            minlength="20"
                            maxlength="500"
                        ></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="link">Project Link *</label>
                            <input 
                                type="url" 
                                id="link" 
                                placeholder="https://example.com"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="xpReward">XP Reward *</label>
                            <input 
                                type="number" 
                                id="xpReward" 
                                min="50" 
                                max="500" 
                                placeholder="100"
                                required
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="deadline">Review Deadline *</label>
                        <input 
                            type="datetime-local" 
                            id="deadline" 
                            required
                        >
                    </div>

                    <button type="submit" class="btn-primary" id="submitBtn">
                        Upload Project
                    </button>
                </form>

                <div id="uploadMessage" class="message"></div>
            </section>
        </div>

        <!-- Tab: Apply to Review (Reviewer only) -->
        <div id="apply-tab" class="tab-content">
            <section class="section">
                <h2>Apply to Review</h2>
                <p class="section-subtitle">Build your reputation while earning XP</p>
                
                <div id="applyProjectsList" class="apply-projects-list">
                    <div class="loading">Loading available projects...</div>
                </div>
            </section>
        </div>

        <!-- Tab: Top Reviewers -->
        <div id="reviewers-tab" class="tab-content">
            <section class="section">
                <h2>Top Reviewers</h2>
                <p class="section-subtitle">Verified experts delivering quality feedback</p>
                <div id="reviewersList" class="reviewers-list">
                    <div class="loading">Loading reviewers...</div>
                </div>
            </section>
        </div>

        <!-- Tab: My Dashboard -->
        <div id="dashboard-tab" class="tab-content">
            <section class="section">
                <h2>My Dashboard</h2>
                
                <!-- Owner Dashboard -->
                <div id="ownerDashboard" style="display: none;">
                    <div class="dashboard-stats">
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-value" id="ownerTotalProjects">0</div>
                            <div class="stat-label">Your Projects</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üìã</div>
                            <div class="stat-value" id="ownerTotalApplicants">0</div>
                            <div class="stat-label">Total Applicants</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üí¨</div>
                            <div class="stat-value" id="ownerTotalFeedback">0</div>
                            <div class="stat-label">Total Reviews</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">‚ö†Ô∏è</div>
                            <div class="stat-value" id="ownerPendingActions">0</div>
                            <div class="stat-label">Pending Actions</div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Your Projects</h3>
                    <div id="ownerProjectsList" class="projects-grid">
                        <div class="loading">Loading your projects</div>
                    </div>
                </div>
                
                <!-- Reviewer Dashboard -->
                <div id="reviewerDashboard" style="display: none;">
                    <div class="dashboard-stats">
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üèÜ</div>
                            <div class="stat-value" id="reviewerLevel">1</div>
                            <div class="stat-label">Level</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="reviewerXP">0</div>
                            <div class="stat-label">Total XP</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">üìù</div>
                            <div class="stat-value" id="reviewerTotalReviews">0</div>
                            <div class="stat-label">Reviews</div>
                        </div>
                        <div class="dashboard-stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="reviewerAvgRating">0.0</div>
                            <div class="stat-label">Avg Rating</div>
                        </div>
                    </div>
                    
                    <div style="margin: 2rem 0;">
                        <h3 style="margin-bottom: 1rem;">XP Progress</h3>
                        <div class="xp-progress-bar">
                            <div id="xpProgressFill" class="xp-progress-fill"></div>
                        </div>
                        <p id="xpProgressText" style="text-align: center; margin-top: 0.5rem; color: var(--neutral-mid);"></p>
                    </div>
                    
                    <h3 style="margin-bottom: 1rem;">Your Applications</h3>
                    <div id="reviewerApplicationsList">
                        <div class="loading">Loading applications</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Application Modal -->
        <div id="applicationModal" class="modal">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <h2>Apply to Review Project</h2>
                <div id="modalProjectInfo" class="modal-project-info"></div>
                
                <form id="applicationForm" class="form">
                    <div class="form-group">
                        <label for="qualifications">Why are you qualified? *</label>
                        <textarea 
                            id="qualifications" 
                            rows="4" 
                            placeholder="Explain your relevant experience..."
                            required
                            minlength="20"
                            maxlength="500"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="focusAreas">What will you focus on? *</label>
                        <textarea 
                            id="focusAreas" 
                            rows="4" 
                            placeholder="Describe what aspects you'll review..."
                            required
                            minlength="20"
                            maxlength="500"
                        ></textarea>
                    </div>

                    <div class="nda-section">
                        <div class="nda-box">
                            <h4>Non-Disclosure Agreement</h4>
                            <div class="nda-content">
                                <p><strong>By submitting, you agree to:</strong></p>
                                <ul>
                                    <li>Keep all project information confidential</li>
                                    <li>Not share or distribute any content</li>
                                    <li>Use info only for providing feedback</li>
                                </ul>
                            </div>
                            <label class="nda-checkbox">
                                <input type="checkbox" id="ndaAccept" required>
                                <span>I accept the NDA *</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary">Submit Application</button>
                </form>
            </div>
        </div>

        <!-- Applicants Modal -->
        <div id="applicantsModal" class="modal">
            <div class="modal-content modal-large">
                <span class="modal-close">&times;</span>
                <h2>Project Applicants</h2>
                <div id="applicantsList" class="applicants-list">
                    <div class="loading">Loading applicants</div>
                </div>
            </div>
        </div>

        <!-- Feedback Modal -->
        <div id="feedbackModal" class="modal">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <h2>Submit Feedback</h2>
                <div id="feedbackProjectInfo" class="modal-project-info"></div>
                
                <form id="feedbackForm" class="form">
                    <div class="form-group">
                        <label for="feedbackText">Your Feedback *</label>
                        <textarea 
                            id="feedbackText" 
                            rows="8" 
                            placeholder="Provide detailed, constructive feedback..."
                            required
                            minlength="50"
                            maxlength="2000"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="projectRating">Rate This Project (Optional)</label>
                        <select id="projectRating">
                            <option value="">No rating</option>
                            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ Excellent</option>
                            <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ Good</option>
                            <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ Average</option>
                            <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ Below Average</option>
                            <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ Poor</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary">Submit Feedback</button>
                </form>
            </div>
        </div>

        <!-- Feedback List Modal -->
        <div id="feedbackListModal" class="modal">
            <div class="modal-content modal-large">
                <span class="modal-close">&times;</span>
                <h2>Project Feedback</h2>
                <div id="feedbackList" class="feedback-list">
                    <div class="loading">Loading feedback</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { getCurrentUser, isAuthenticated, signOut } from './lib/auth.js';

        window.addEventListener('load', async () => {
            console.log('=== INDEX PAGE LOADING ===');
            
            try {
                // Check authentication
                const authenticated = await isAuthenticated();
                
                if (!authenticated) {
                    console.log('Not authenticated - redirecting');
                    window.location.href = 'login.html';
                    return;
                }
                
                const user = await getCurrentUser();
                console.log('‚úì User authenticated:', user.id);
                
                // Display user name
                const userNameEl = document.getElementById('userName');
                if (userNameEl && user) {
                    userNameEl.textContent = user.name || user.email;
                }
                
                // Set global user
                window.currentUser = user;
                
                // Sign out handler
                window.handleSignOut = async () => {
                    console.log('Signing out...');
                    await signOut();
                    window.location.href = 'login.html';
                };
                
                // Load main app
                const script = document.createElement('script');
                script.src = 'app.js';
                script.type = 'module';
                script.onload = () => console.log('‚úì App loaded');
                script.onerror = () => {
                    console.error('Failed to load app');
                    alert('Failed to load application. Please refresh.');
                };
                document.body.appendChild(script);
                
            } catch (error) {
                console.error('Initialization error:', error);
                alert('Authentication failed. Please log in again.');
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>