<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelpMarq - Choose Your Role</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card role-select-card">
            <div class="auth-header">
                <h1>Welcome to HelpMarq!</h1>
                <p class="tagline">Choose how you want to get started</p>
            </div>
            
            <div class="role-options">
                <div class="role-card" onclick="selectRole('owner')">
                    <div class="role-icon">üìä</div>
                    <h3>Project Owner</h3>
                    <p>Upload projects and get expert feedback</p>
                    <button class="btn-primary">I'm a Project Owner</button>
                </div>
                
                <div class="role-card" onclick="selectRole('reviewer')">
                    <div class="role-icon">‚≠ê</div>
                    <h3>Reviewer</h3>
                    <p>Review projects and earn income</p>
                    <button class="btn-primary">I'm a Reviewer</button>
                </div>
            </div>
        </div>
    </div>

    <script 
        async 
        crossorigin="anonymous" 
        data-clerk-publishable-key="pk_test_Y29ycmVjdC1zdGlua2J1Zy05OS5jbGVyay5hY2NvdW50cy5kZXYk"
        onload="window.Clerk.load()"
        src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@4/dist/clerk.browser.js"
    ></script>

    <script>
        window.addEventListener('load', async () => {
            console.log('Role select page loaded');
            
            if (!window.Clerk) {
                console.error('Clerk failed to load');
                alert('Authentication system failed to load. Please refresh the page.');
                return;
            }
            
            await window.Clerk.load();
            console.log('Clerk loaded');
            
            if (!window.Clerk.user) {
                console.log('No user found, redirecting to login');
                window.location.href = 'login.html';
                return;
            }

            console.log('User authenticated:', window.Clerk.user.id);

            // Role selection handlers
        window.selectRole = async function(role) {
    console.log('=== ROLE SELECTED:', role, '===');
    
    try {
        // Save role to localStorage FIRST
        localStorage.setItem('userRole', role);
        console.log('‚úì Role saved to localStorage');
        
        // Set sessionStorage flag to prevent redirect loop
        sessionStorage.setItem('roleJustSelected', 'true');
        
        if (role === 'owner') {
            console.log('‚Üí Redirecting to index.html (owner dashboard)');
            
            // Small delay to ensure storage is written
            await new Promise(resolve => setTimeout(resolve, 100));
            
            window.location.href = 'index.html';
            
        } else if (role === 'reviewer') {
            console.log('‚Üí Redirecting to create-reviewer.html');
            
            await new Promise(resolve => setTimeout(resolve, 100));
            
            window.location.href = 'create-reviewer.html';
        }
        
    } catch (error) {
        console.error('Error selecting role:', error);
        alert('Error selecting role. Please try again.');
    }
};
            
            console.log('Role selection ready');
        });
    </script>
    <script>
    window.addEventListener('load', async () => {
        console.log('=== ROLE SELECT PAGE LOADED ===');
        
        if (!window.Clerk) {
            alert('Authentication failed to load. Please refresh.');
            return;
        }
        
        await window.Clerk.load();
        
        if (!window.Clerk.user) {
            console.log('No user, redirecting to login');
            window.location.href = 'login.html';
            return;
        }

        console.log('‚úì User authenticated:', window.Clerk.user.id);

        // CRITICAL: Check if role already exists
        const existingRole = localStorage.getItem('userRole');
        if (existingRole) {
            console.log('‚ö†Ô∏è Role already exists:', existingRole, '- redirecting to app');
            window.location.href = 'index.html';
            return;
        }

        // Role selection handlers
        window.selectRole = function(role) {
            console.log('=== ROLE SELECTED:', role, '===');
            
            // TRIPLE-SAVE to ensure persistence
            localStorage.setItem('userRole', role);
            sessionStorage.setItem('userRole', role);
            sessionStorage.setItem('roleJustSelected', 'true');
            
            // Verify it saved
            const saved = localStorage.getItem('userRole');
            console.log('‚úì Role saved and verified:', saved);
            
            if (saved !== role) {
                alert('Failed to save role. Please try again.');
                return;
            }
            
            // Redirect based on role
            if (role === 'owner') {
                console.log('‚Üí Redirecting to index.html');
                setTimeout(() => {
                    window.location.replace('index.html'); // Use replace to prevent back button issues
                }, 200);
                
            } else if (role === 'reviewer') {
                console.log('‚Üí Redirecting to create-reviewer.html');
                setTimeout(() => {
                    window.location.replace('create-reviewer.html');
                }, 200);
            }
        };
        
        console.log('Role selection ready');
    });
</script>
</body>
</html>